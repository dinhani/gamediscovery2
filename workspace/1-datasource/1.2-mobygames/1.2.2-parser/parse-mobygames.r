# ==============================================================================
# LIBRARIES
# ==============================================================================
source("../../libraries.r", encoding = "UTF-8")

# ==============================================================================
# FUNCTIONS
# ==============================================================================
source("functions/ParseMobyGamesHTMLFile.r", encoding="UTF-8")

# ==============================================================================
# READ FILES
# ==============================================================================
games.files = list.files("../data/raw", pattern = "*.html", full.names = TRUE)

# ==============================================================================
# PARSE FILES
# ==============================================================================
games = pblapply(games.files, ParseMobyGamesHTMLFile) %>%
  rbindlist(fill = TRUE) %>%
  mutate(
    Platform = if_else(is.na(Platforms), Platform, Platforms)
  )

# add column prefix
colnames(games) = paste0("MB_", colnames(games))

# ==============================================================================
# SAVE GAMES
# ==============================================================================
saveRDS(games, file = "../data/parsed/games.rds")
